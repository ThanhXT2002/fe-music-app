<!-- Main Player Container -->
<div
  class="player-container h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white relative overflow-hidden"
>
  <!-- Background Album Art -->
  <div class="absolute inset-0 opacity-20">
    @if (currentSong()?.thumbnail) {
    <img
      [src]="currentSong()!.thumbnail"
      [alt]="currentSong()!.title"
      class="w-full h-full object-cover blur-lg scale-110"
    />
    }
  </div>

  <!-- Header -->
  <div class="relative z-10 flex items-center justify-between p-4">
    <button
      (click)="closeModal()"
      class="h-10 w-10 flex items-center justify-center rounded-full backdrop-blur-sm hover:bg-black/30 transition-colors"
    >
      <i class="fa-solid fa-chevron-down text-xl"></i>
    </button>

    <div class="text-center">
      <p class="text-sm opacity-75">NOW PLAYING</p>
      <p class="font-medium">{{currentSong()?.album || ' _ ____ _ '}}</p>
    </div>

    <button
      class="h-10 w-10 flex items-center justify-center rounded-full backdrop-blur-sm hover:bg-black/30 transition-colors"
    >
      <i class="fa-solid fa-bars text-xl"></i>
    </button>
  </div>

  <!-- Main Content -->
  <div
    class="relative z-10 flex flex-col h-[calc(100%-4rem)] px-6 pb-6 justify-between"
  >
    <!-- Album Art -->
    <div class="flex-1 flex items-center justify-center my-4">
      <div
        class="w-[90%] aspect-square rounded-full overflow-hidden shadow-2xl"
        [ngClass]="{
          'spin-with-fill': true,
          'spin-paused': !isPlaying()
        }"
      >
        @if (currentSong()?.thumbnail) {
        <img
          [src]="currentSong()!.thumbnail"
          [alt]="currentSong()!.title"
          class="w-full h-full object-cover"
        />
        } @else {
        <div class="w-full h-full flex items-center justify-center">
          <i
            class="fa-solid fa-compact-disc text-[20rem] bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent"
          ></i>
        </div>
        }
      </div>
    </div>

    <!-- Song Info -->
    <div class="text-center mb-6">
      <h1 class="font-medium mb-2 text-white">
        {{ currentSong()?.title || 'No song selected' }}
      </h1>
      <p class="text-lg text-white/70">
        {{ currentSong()?.artist || 'Unknown Artist' }}
      </p>
    </div>

    <!-- Progress Bar -->
    <div class="mb-8">
      <div class="flex items-center justify-between text-sm text-white/70 mb-5 px-5">
        <button><i class="fa-solid fa-share-nodes text-lg"></i></button>

        <!-- <button
      (click)="toggleFavorite()"
      class="p-2 rounded-full bg-black/20 backdrop-blur-sm hover:bg-black/30 transition-colors">
      <svg class="w-6 h-6" [class.text-red-500]="currentSong()?.isFavorite" [class.text-white]="!currentSong()?.isFavorite" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
    </button> -->
        <button
        (click)="toggleFavorite()"
        >
          <i class="fa-solid fa-heart text-lg"
          [ngClass]="currentSong()?.isFavorite ? 'text-red-500' : 'text-white/70'"></i>
        </button>
      </div>

      <div
        class="relative h-1.5 bg-white/20 rounded-full cursor-pointer group"
        (mousedown)="onProgressStart($event)"
        (touchstart)="onProgressStart($event)"
        (mousemove)="onProgressMove($event)"
        (touchmove)="onProgressMove($event)"
        (mouseup)="onProgressEnd($event)"
        (touchend)="onProgressEnd($event)"
      >
        <div
          class="absolute h-full bg-white rounded-full transition-all duration-100"
          [style.width.%]="progress()"
        ></div>

        <div
          class="absolute w-4 h-4 bg-white rounded-full shadow-lg transform -translate-y-1/2 top-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity"
          [style.left.%]="progress()"
        ></div>
      </div>
      <div class="flex items-center justify-between text-sm text-white/70 mt-2">
        <span>{{ progressTime() }}</span>
        <span>{{ durationTime() }}</span>
      </div>
    </div>

    <!-- Main Controls -->
    <div class="flex items-center justify-around w-full mb-10">
      <!-- Shuffle -->
      <button
        (click)="toggleShuffle()"
        [class]="getShuffleColor()"
        class="p-3  rounded-full transition-colors"
      >
        <i class="fas fa-random text-xl"></i>
      </button>

      <!-- Previous -->
      <button
        (click)="previousTrack()"
        class="!w-10 !h-10  rounded-full transition-colors"
      >
        <i class="fas fa-step-backward text-2xl"></i>
      </button>

      <!-- Play/Pause -->
      <button
        (click)="togglePlayPause()"
        class="!w-14 !h-14  text-white rounded-full flex-shrink-0 flex items-center justify-center hover:scale-105 transition-transform shadow-2xl"
      >
        @if (!isPlaying()) {
        <i class="fas fa-play text-3xl"></i>
        } @else {
        <i class="fas fa-pause text-3xl"></i>
        }
      </button>

      <!-- Next -->
      <button
        (click)="nextTrack()"
        class="p-3  rounded-full transition-colors"
      >
        <i class="fas fa-step-forward text-2xl"></i>
      </button>

      <!-- Repeat -->
      <button
        (click)="toggleRepeat()"
        [class]="getRepeatColor()"
        class="p-3 rounded-full transition-colors"
      >
        @if (repeatMode() !== 'one') {
        <i class="fas fa-sync-alt text-xl"></i>
        } @else {
        <i class="fas fa-redo-alt text-xl"></i>
        }
      </button>
    </div>
  </div>
</div>
